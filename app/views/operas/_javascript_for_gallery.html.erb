<script type="text/javascript">
$(document).ready(function(){
  $("img").one("load", function(){
    var img = this;
    setTimeout(start, 100);
  }
);

  function start(){
    $(window).resize(fix_image_height)
    fix_image_height()
  }

  function fix_image_height(){
    if ( image_have_to_be_resized()) {
      height_at_100_per_cent()      
    } else {
      $('img').css('height', 'auto')  
      $('img').css('min-width', '')  
    }
  }

  function image_have_to_be_resized(){
    return window_width_more_big_than_image() && $(window).width() > 750 
  }

  function window_width_more_big_than_image(){
        var image = new Image()
    image.src = $('img').attr('src')
    return $(window).width() > image.naturalWidth
  }


  function window_height_more_big_than_image(){
    var image = new Image()
    image.src = $('img').attr('src')
    return $(window).width() > image.naturalWidth
  }


  function height_at_100_per_cent(){
    var img = $('img')
    var offset = img.offset();
    var altezza = $(window).height() - offset.top - 20
    // 400px is a hard coded number that is a good relative measure
    // when window height is too much little to contain entire image
    if ($(window).height() < 400){
      altezza = 400 - offset.top - 20
    }
    if (altezza > 0){
      $('img').css('height', altezza)  
    }
    console.log(altezza)
    var image = new Image()
    image.src = $('img').attr('src')
    console.log(image)
    if ($('img').height() > image.naturalHeight ){
      $('img').height(image.naturalHeight)
    }
  }


    function keydown_(e){
      var key = e.which||e.keyCode;
      switch(key){
        //left arrow
        case 37:
          $("#prev").css('font-weight', 'bold')
          $("#prev").css('text-decoration', 'underline')
          $("#prev")[0].click()
        break;
        //right arrow
        case 39:
          //$("#next").click()
          $("#next").css('font-weight', 'bold')
          $("#next").css('text-decoration', 'underline')
          $("#next")[0].click()
        break;
      }
    }

   $(document).keyup(function(e){ keydown_(e) })
})
</script>