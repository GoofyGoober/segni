<script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.min.js"></script>

<script type="text/javascript">

$('#container').imagesLoaded()
  .always( function( instance ) {
    console.log('all images loaded');
  })
  .done( function( instance ) {
    $(window).resize(setupHeightImages)
    setupHeightImages()
    $('#opera-image img').fadeIn()
    console.log("DONE!")
  })
  .fail( function() {
    console.log('all images loaded, at least one is broken');
  })
  .progress( function( instance, image ) {
    var result = image.isLoaded ? 'loaded' : 'broken';
    console.log( 'image is ' + result + ' for ' + image.img.src );
  });



function setupHeightImages(){
  var wh =$(window).height()
  var topy = $('#opera-image img').offset().top
  var margine_sotto = 20
  var calculate = wh-topy-margine_sotto 
  if (calculate<300){ calculate = 300; }
  var misure = calculate+'px'
  $('#opera-image img').css('max-height', misure)
}


function keydown_(e){
  var key = e.which||e.keyCode;
  switch(key){
    //left arrow
    case 37:
      if ( $('#prev').length > 0 ) {
        $("img").fadeOut(100)
        colorize_button('#prev') 
        $("#prev")[0].click()
        
      }
    break;
    //right arrow
    case 39:
      //$("#next").click()
      if ( $('#next').length > 0 ) {
        $("img").fadeOut(100)
        
        colorize_button('#next') 
        $("#next")[0].click()
        
      }
    break;
  }
}

function colorize_button(_id){
  $(_id).css('background-color', '#e6e6e6')
  $(_id).css('border-color', '#adadad')
  $(_id).css('color', '#333333')
}

$(document).keyup(function(e){ keydown_(e) })

</script>